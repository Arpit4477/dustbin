<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin - Manage Users</title>
</head>
<body>
    <h1>Manage Users</h1>
    <table id="usersTable">
        <thead>
            <tr>
                <th>Username</th>
                <th>Role</th>
                <th>Location IDs</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Users will be dynamically inserted here -->
        </tbody>
    </table>
    <script>
        // Fetch users data and populate the table
        async function fetchUsers() {
            const response = await fetch('/api/users');
            const users = await response.json();
            const tableBody = document.getElementById('usersTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');

                const usernameCell = document.createElement('td');
                usernameCell.textContent = user.username;
                row.appendChild(usernameCell);

                const roleCell = document.createElement('td');
                roleCell.textContent = user.role;
                row.appendChild(roleCell);

                const locationIdsCell = document.createElement('td');
                const locationInput = document.createElement('input');
                locationInput.type = 'text';
                locationInput.value = user.locationIds.join(', ');
                locationIdsCell.appendChild(locationInput);
                row.appendChild(locationIdsCell);

                const actionsCell = document.createElement('td');
                const saveButton = document.createElement('button');
                saveButton.textContent = 'Save';
                saveButton.onclick = () => updateUser(user._id, locationInput.value);
                actionsCell.appendChild(saveButton);
                row.appendChild(actionsCell);

                tableBody.appendChild(row);
            });
        }

        // Update user data
        async function updateUser(userId, locationIds) {
            const response = await fetch(`/api/users/${userId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ locationIds: locationIds.split(',').map(id => id.trim()) })
            });

            if (response.ok) {
                alert('User updated successfully!');
            } else {
                alert('Error updating user.');
            }
        }

        // Fetch users data on page load
        document.addEventListener('DOMContentLoaded', fetchUsers);
    </script>
</body>
</html>

